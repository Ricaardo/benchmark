# Benchmark Web Server

é€šè¿‡ Web ç•Œé¢ç®¡ç†å’Œè¿è¡Œ Bilibili Player çš„æ€§èƒ½æµ‹è¯• - **ç”¨ä¾‹é©±åŠ¨çš„æ€§èƒ½æµ‹è¯•å¹³å°**

## ğŸ“– æ–‡æ¡£å¯¼èˆª

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| [README.md](README.md) | ğŸ“˜ ä¸»æ–‡æ¡£ - åŠŸèƒ½è¯´æ˜å’Œä½¿ç”¨æŒ‡å—ï¼ˆå½“å‰æ–‡æ¡£ï¼‰ |
| [QUICKSTART.md](QUICKSTART.md) | âš¡ å¿«é€Ÿå¼€å§‹ - 3åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹ |
| [USAGE_GUIDE.md](USAGE_GUIDE.md) | ğŸ“– ä½¿ç”¨æŒ‡å— - æµ‹è¯•ç”¨ä¾‹ç®¡ç†ä¸Per-URLé…ç½® |
| [TEST_RECORDS_GUIDE.md](TEST_RECORDS_GUIDE.md) | ğŸ“ æµ‹è¯•è®°å½• - æµ‹è¯•å†å²è®°å½•ç®¡ç†å’ŒæŸ¥è¯¢ |
| [PERFCAT_INTEGRATION.md](PERFCAT_INTEGRATION.md) | ğŸ“Š Perfcaté›†æˆ - è‡ªåŠ¨ä¸Šä¼ æµ‹è¯•æŠ¥å‘Šåˆ°Perfcat |
| [PERFCAT_SETUP_GUIDE.md](PERFCAT_SETUP_GUIDE.md) | ğŸ”§ Perfcatè®¾ç½® - é…ç½®Perfcaté›†æˆ |
| [ONE_CLICK_DEPLOY.md](ONE_CLICK_DEPLOY.md) | ğŸš€ ä¸€é”®éƒ¨ç½² - ä¸‰ç«¯ï¼ˆWin/Mac/Linuxï¼‰ä¸€é”®éƒ¨ç½²æŒ‡å— |
| [PRESET_SYSTEM_GUIDE.md](PRESET_SYSTEM_GUIDE.md) | ğŸ¨ é¢„è®¾ç³»ç»Ÿ - æµ‹è¯•ç”¨ä¾‹æ¨¡æ¿å’Œå¿«é€Ÿé…ç½® |
| [BILIBILI_LIVE_PRESETS.md](BILIBILI_LIVE_PRESETS.md) | ğŸ”´ Bç«™ç›´æ’­é¢„è®¾ - ç›´æ’­æµ‹è¯•ä¸“ç”¨æ“ä½œæŒ‡å— |
| [DATA_VISUALIZATION.md](DATA_VISUALIZATION.md) | ğŸ“ˆ æ•°æ®å¯è§†åŒ– - æµ‹è¯•æŠ¥å‘Šå›¾è¡¨å’Œåˆ†æ |
| [DEPLOYMENT.md](DEPLOYMENT.md) | ğŸš¢ éƒ¨ç½²æŒ‡å— - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆ |
| [INSTALL.md](INSTALL.md) | ğŸ“¦ å®‰è£…æŒ‡å— - ä¾èµ–å®‰è£…å’Œç¯å¢ƒé…ç½® |
| [IMPORTANT.md](IMPORTANT.md) | âš ï¸ é‡è¦è¯´æ˜ - å…³äº benchmark åŒ…çš„è¯´æ˜ |
| [TROUBLESHOOTING.md](TROUBLESHOOTING.md) | ğŸ”§ æ•…éšœæ’æŸ¥ - å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ |
| [SUMMARY.md](SUMMARY.md) | ğŸ“Š é¡¹ç›®æ€»ç»“ - æ¶æ„è®¾è®¡å’ŒæŠ€æœ¯è¯´æ˜ |
| [CHANGELOG.md](CHANGELOG.md) | ğŸ“ æ›´æ–°æ—¥å¿— - ç‰ˆæœ¬æ›´æ–°è®°å½• |

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### ğŸ§ª æµ‹è¯•ç”¨ä¾‹ç®¡ç†

- **æŒä¹…åŒ–å­˜å‚¨** - æµ‹è¯•ç”¨ä¾‹ä¿å­˜åœ¨æœåŠ¡å™¨ï¼Œè·¨æµè§ˆå™¨åŒæ­¥
- **æ¨¡æ¿ç³»ç»Ÿ** - 10+ é¢„è®¾æ¨¡æ¿ï¼Œå¿«é€Ÿåˆ›å»ºå¸¸è§æµ‹è¯•åœºæ™¯
- **æ ‡ç­¾åˆ†ç±»** - ä½¿ç”¨æ ‡ç­¾ç»„ç»‡å’Œç­›é€‰æµ‹è¯•ç”¨ä¾‹
- **æ‰§è¡Œå†å²** - è‡ªåŠ¨å…³è”æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œè®°å½•
- **Per-URLé…ç½®** - åŒä¸€ç”¨ä¾‹ä¸­ä¸åŒURLå¯ä½¿ç”¨ä¸åŒé…ç½®ï¼ˆCookieã€å»¶è¿Ÿã€Headersç­‰ï¼‰

### ğŸš€ æµ‹è¯•æ‰§è¡Œ

- **å¤šRunneræ”¯æŒ** - Initializationï¼ˆåˆå§‹åŒ–ï¼‰ã€Runtimeï¼ˆè¿è¡Œæ—¶ï¼‰ã€MemoryLeakï¼ˆå†…å­˜æ³„æ¼ï¼‰
- **å¹¶å‘æ§åˆ¶** - æ”¯æŒå¤šä¸ªæµ‹è¯•ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ
- **å®æ—¶ç›‘æ§** - WebSocketå®æ—¶æ¨é€æµ‹è¯•æ—¥å¿—å’Œè¿›åº¦
- **ä¼˜é›…åœæ­¢** - æ”¯æŒæ­£å¸¸åœæ­¢å’Œå¼ºåˆ¶ç»ˆæ­¢
- **é‡å¤æ‰§è¡Œ** - å¯é…ç½®æµ‹è¯•é‡å¤æ¬¡æ•°

### ğŸ“Š æ•°æ®åˆ†æ

- **Perfcaté›†æˆ** - è‡ªåŠ¨ä¸Šä¼ æŠ¥å‘Šåˆ°Perfcatï¼Œç”Ÿæˆå¯è§†åŒ–å›¾è¡¨
- **æµ‹è¯•è®°å½•** - å®Œæ•´çš„æ‰§è¡Œå†å²ï¼Œæ”¯æŒç­›é€‰ã€æœç´¢ã€ç»Ÿè®¡
- **æ•°æ®å‹ç¼©** - LZ-Stringå‹ç¼©ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“
- **å›¾è¡¨æ¨¡å¼** - æ”¯æŒæ ‡å‡†å’Œå›¾è¡¨ä¸¤ç§æŠ¥å‘ŠæŸ¥çœ‹æ¨¡å¼

### ğŸ”§ é«˜çº§é…ç½®

- **Cookieç®¡ç†** - æ”¯æŒå­—ç¬¦ä¸²æˆ–å¯¹è±¡æ ¼å¼çš„Cookieé…ç½®
- **ç½‘ç»œæ¨¡æ‹Ÿ** - æ¨¡æ‹Ÿ2G/3G/4Gç­‰ä¸åŒç½‘ç»œç¯å¢ƒ
- **è®¾å¤‡æ¨¡æ‹Ÿ** - æ”¯æŒDesktop/Mobileè®¾å¤‡é…ç½®
- **èµ„æºé˜»æ­¢** - å¯é˜»æ­¢ç‰¹å®šèµ„æºåŠ è½½ï¼ˆå›¾ç‰‡ã€å­—ä½“ç­‰ï¼‰
- **è‡ªå®šä¹‰CSS** - æ³¨å…¥CSSæ ·å¼ï¼ˆå¦‚éšè—å¹¿å‘Šï¼‰
- **ç”Ÿå‘½å‘¨æœŸé’©å­** - beforePageLoadã€onPageLoadedã€onPageTestingç­‰5ä¸ªé’©å­

### ğŸ” å®‰å…¨ä¸API

- **APIå¯†é’¥** - æ”¯æŒå¤šå¯†é’¥ç®¡ç†ï¼Œä¿æŠ¤APIæ¥å£
- **Webhooké€šçŸ¥** - æµ‹è¯•å®Œæˆåè‡ªåŠ¨æ¨é€é€šçŸ¥
- **CORSæ”¯æŒ** - å…è®¸è·¨åŸŸAPIè°ƒç”¨

## å‰ç½®è¦æ±‚

- Node.js >= 18.0.0
- npm >= 9.0.0
- `@bilibili-player/benchmark` åŒ…ï¼ˆBç«™å†…éƒ¨å·¥å…·ï¼‰

> ğŸ’¡ **é¦–æ¬¡å®‰è£…**: è¯·å…ˆæŸ¥çœ‹ [INSTALL.md](INSTALL.md) äº†è§£å¦‚ä½•å®‰è£…ä¾èµ–å’Œ benchmark å·¥å…·ã€‚

## å¿«é€Ÿå¼€å§‹

### ğŸš€ ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰

#### æ–¹å¼ 1: æœ¬åœ°éƒ¨ç½²è„šæœ¬

**macOS / Linux / WSL**:
```bash
./deploy.sh
```

**Windows**:
```bash
deploy.bat
```

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… è‡ªåŠ¨æ£€æµ‹æ“ä½œç³»ç»Ÿå’Œ Node.js ç¯å¢ƒ
- âœ… è‡ªåŠ¨å®‰è£…ä¾èµ–
- âœ… è‡ªåŠ¨ç¼–è¯‘ TypeScript
- âœ… è‡ªåŠ¨å¯åŠ¨æœåŠ¡å™¨
- âœ… è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨

#### æ–¹å¼ 2: Docker éƒ¨ç½²ï¼ˆè·¨å¹³å°ï¼‰

**ä½¿ç”¨ Docker Composeï¼ˆæ¨èï¼‰**:
```bash
docker-compose up -d
```

**æˆ–ä½¿ç”¨ Docker å‘½ä»¤**:
```bash
# æ„å»ºé•œåƒ
npm run docker:build

# è¿è¡Œå®¹å™¨
npm run docker:run
```

**ä¼˜åŠ¿**:

- âœ… æ— éœ€å®‰è£… Node.js
- âœ… ç¯å¢ƒéš”ç¦»ï¼Œé¿å…ä¾èµ–å†²çª
- âœ… ä¸€æ¬¡æ„å»ºï¼Œåˆ°å¤„è¿è¡Œ
- âœ… æ”¯æŒ Windows/macOS/Linux
- âœ… è‡ªåŠ¨å¥åº·æ£€æŸ¥å’Œé‡å¯

**è®¿é—®æœåŠ¡**:

- æœ¬åœ°è®¿é—®: `http://localhost:3000`
- ç½‘ç»œè®¿é—®: `http://<ä½ çš„IP>:3000`

> ğŸ“– è¯¦ç»† Docker éƒ¨ç½²æŒ‡å—è¯·å‚è€ƒ [DOCKER_DEPLOYMENT.md](DOCKER_DEPLOYMENT.md)

### ğŸ“‹ æ‰‹åŠ¨éƒ¨ç½²

å¦‚æœæ‚¨éœ€è¦æ›´å¤šæ§åˆ¶ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

**1. å®‰è£…ä¾èµ–**

```bash
npm install
```

> âš ï¸ å¦‚æœé‡åˆ° `@bilibili-player/benchmark` å®‰è£…é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ [INSTALL.md](INSTALL.md)

**2. ç¼–è¯‘ä»£ç **

```bash
npm run build
```

**3. å¯åŠ¨æœåŠ¡å™¨**

å¼€å‘æ¨¡å¼ï¼ˆæ¨èï¼Œæ”¯æŒçƒ­é‡è½½ï¼‰:
```bash
npm run dev
```

ç”Ÿäº§æ¨¡å¼:
```bash
npm start
```

**4. è®¿é—® Web ç•Œé¢**

æ‰“å¼€æµè§ˆå™¨è®¿é—®: `http://localhost:3000`

## ğŸ“– ä½¿ç”¨è¯´æ˜

### ğŸ¯ ä¸»ç•Œé¢ - æµ‹è¯•ç”¨ä¾‹ç®¡ç†

è®¿é—® `http://localhost:3000` è¿›å…¥ä¸»ç•Œé¢ï¼š

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

1. **æµ‹è¯•ç”¨ä¾‹åˆ—è¡¨** - æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹
   - æŒ‰æ ‡ç­¾ç­›é€‰ç”¨ä¾‹
   - æœç´¢ç”¨ä¾‹åç§°å’Œæè¿°
   - æŸ¥çœ‹ç”¨ä¾‹è¯¦æƒ…å’Œé…ç½®

2. **åˆ›å»ºæµ‹è¯•ç”¨ä¾‹** - ç‚¹å‡»"â• æ·»åŠ æµ‹è¯•ç”¨ä¾‹"
   - å¡«å†™åŸºæœ¬ä¿¡æ¯ï¼ˆåç§°ã€æè¿°ã€æ ‡ç­¾ï¼‰
   - é€‰æ‹©Runnerç±»å‹ï¼ˆå¯å¤šé€‰ï¼‰
   - é…ç½®æµ‹è¯•å‚æ•°ï¼ˆè¿è¡Œæ—¶é•¿ã€é‡å¤æ¬¡æ•°ç­‰ï¼‰
   - æ·»åŠ æµ‹è¯•URLï¼ˆæ”¯æŒå¤šä¸ªURLï¼‰
   - é…ç½®é«˜çº§é€‰é¡¹ï¼ˆCookieã€ç½‘ç»œã€é’©å­ç­‰ï¼‰

3. **Per-URLé…ç½®** - ä¸ºæ¯ä¸ªURLç‹¬ç«‹é…ç½®
   - Cookieï¼ˆæ”¯æŒå­—ç¬¦ä¸²æˆ–å¯¹è±¡æ ¼å¼ï¼‰
   - é¡µé¢å»¶è¿Ÿï¼ˆdelayMsï¼‰
   - HTTP Headersï¼ˆè‡ªå®šä¹‰è¯·æ±‚å¤´ï¼‰
   - ç½‘ç»œæ¡ä»¶ï¼ˆæ¨¡æ‹Ÿ2G/3G/4Gï¼‰
   - è‡ªå®šä¹‰CSSï¼ˆæ³¨å…¥æ ·å¼ï¼‰
   - èµ„æºé˜»æ­¢åˆ—è¡¨ï¼ˆblockListï¼‰
   - è®¾å¤‡é€‰é¡¹ï¼ˆDesktop/Mobileï¼‰
   - ç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆ5ä¸ªé’©å­å‡½æ•°ï¼‰

4. **æ‰§è¡Œæµ‹è¯•** - ç›´æ¥è¿è¡Œæˆ–æŸ¥çœ‹å†å²
   - ç‚¹å‡»"è¿è¡Œ"æŒ‰é’®å¯åŠ¨æµ‹è¯•
   - æ”¯æŒé€‰æ‹©ç‰¹å®šRunneræ‰§è¡Œ
   - å®æ—¶æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€å’Œè¾“å‡º
   - æŸ¥çœ‹æ‰§è¡Œå†å²è®°å½•

5. **é¢„è®¾æ¨¡æ¿** - å¿«é€Ÿåˆ›å»ºå¸¸è§åœºæ™¯
   - 10+ é¢„è®¾æ¨¡æ¿å¯é€‰
   - ä¸€é”®åº”ç”¨æ¨¡æ¿é…ç½®
   - æ”¯æŒè‡ªå®šä¹‰ä¿®æ”¹

> ğŸ“– è¯¦ç»†æ•™ç¨‹è¯·å‚è€ƒ [USAGE_GUIDE.md](USAGE_GUIDE.md)

### ğŸ“Š æµ‹è¯•è®°å½•

è®¿é—® `http://localhost:3000/records.html` æŸ¥çœ‹æ‰§è¡Œå†å²ï¼š

**åŠŸèƒ½ç‰¹æ€§**ï¼š

- ğŸ“ è‡ªåŠ¨ä¿å­˜æ¯æ¬¡æµ‹è¯•çš„å®Œæ•´ä¿¡æ¯
- ğŸ” æŒ‰Runnerç±»å‹ã€çŠ¶æ€ã€æ—¶é—´èŒƒå›´ç­›é€‰
- ğŸ“Š ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ€»æ•°ã€æˆåŠŸç‡ã€å¹³å‡è€—æ—¶ï¼‰
- ğŸ”— ç›´æ¥è®¿é—®PerfcatæŠ¥å‘Šé“¾æ¥ï¼ˆæ ‡å‡†+å›¾è¡¨ï¼‰
- ğŸ“ˆ å¯è§†åŒ–å›¾è¡¨å±•ç¤ºè¶‹åŠ¿
- ğŸ“„ æ”¯æŒåˆ†é¡µï¼ˆ20/50/100æ¡/é¡µï¼‰
- ğŸ—‘ï¸ åˆ é™¤å•æ¡æˆ–æ‰¹é‡æ¸…ç©º

**è®°å½•å†…å®¹**ï¼š

- æµ‹è¯•ç”¨ä¾‹åç§°å’ŒID
- Runnerç±»å‹
- æ‰§è¡ŒçŠ¶æ€ï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰
- å¼€å§‹æ—¶é—´å’Œè¿è¡Œæ—¶é•¿
- PerfcatæŠ¥å‘Šé“¾æ¥
- é€€å‡ºä»£ç å’Œé”™è¯¯ä¿¡æ¯

> ğŸ“– è¯¦ç»†è¯´æ˜è¯·å‚è€ƒ [TEST_RECORDS_GUIDE.md](TEST_RECORDS_GUIDE.md)

### ğŸ”§ Perfcaté›†æˆ

**é…ç½®Perfcat**ï¼ˆå¯é€‰ä½†æ¨èï¼‰ï¼š

1. åœ¨ä¸»ç•Œé¢ç‚¹å‡»"âš™ï¸ è®¾ç½®"
2. è¿›å…¥"Perfcaté…ç½®"æ ‡ç­¾
3. å¡«å†™Perfcat URLå’ŒCookie
4. ç‚¹å‡»"æµ‹è¯•è¿æ¥"éªŒè¯é…ç½®
5. ä¿å­˜é…ç½®

**è‡ªåŠ¨ä¸Šä¼ æµç¨‹**ï¼š

æµ‹è¯•å®Œæˆåè‡ªåŠ¨ï¼š
1. ç”ŸæˆJSONæ ¼å¼çš„æµ‹è¯•æŠ¥å‘Š
2. ä½¿ç”¨LZ-Stringå‹ç¼©æ•°æ®
3. ä¸Šä¼ åˆ°PerfcatæœåŠ¡
4. è¿”å›ä¸¤ç§é“¾æ¥ï¼ˆæ ‡å‡†è§†å›¾+å›¾è¡¨æ¨¡å¼ï¼‰
5. ä¿å­˜åˆ°æµ‹è¯•è®°å½•

> ğŸ“– è¯¦ç»†é…ç½®è¯·å‚è€ƒ [PERFCAT_INTEGRATION.md](PERFCAT_INTEGRATION.md)

## ğŸ”Œ API æ¥å£

æœåŠ¡å™¨æä¾›ä»¥ä¸‹ REST API:

### æµ‹è¯•ç”¨ä¾‹ç®¡ç† API

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/testcases` | GET | è·å–æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼ˆæ”¯æŒtagsã€searchæŸ¥è¯¢å‚æ•°ï¼‰ |
| `/api/testcases/:id` | GET | è·å–å•ä¸ªæµ‹è¯•ç”¨ä¾‹è¯¦æƒ… |
| `/api/testcases` | POST | åˆ›å»ºæ–°æµ‹è¯•ç”¨ä¾‹ |
| `/api/testcases/:id` | PUT | æ›´æ–°æµ‹è¯•ç”¨ä¾‹ |
| `/api/testcases/:id` | DELETE | åˆ é™¤æµ‹è¯•ç”¨ä¾‹ |
| `/api/testcases/:id/executions` | GET | è·å–æµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œå†å² |

### ä»»åŠ¡æ‰§è¡Œ API

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/tasks` | GET | è·å–æ‰€æœ‰ä»»åŠ¡åˆ—è¡¨ |
| `/api/tasks/:taskId` | GET | è·å–å•ä¸ªä»»åŠ¡è¯¦æƒ… |
| `/api/tasks` | POST | å¯åŠ¨æµ‹è¯•ä»»åŠ¡ï¼ˆéœ€ä¼ é€’testCaseIdå’Œrunnerï¼‰ |
| `/api/tasks/:taskId/stop` | POST | åœæ­¢æŒ‡å®šä»»åŠ¡ï¼ˆæ”¯æŒforceå‚æ•°å¼ºåˆ¶åœæ­¢ï¼‰ |
| `/api/tasks/:taskId` | DELETE | åˆ é™¤ä»»åŠ¡ |

### æµ‹è¯•è®°å½• API

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/test-records` | GET | è·å–æµ‹è¯•è®°å½•åˆ—è¡¨ï¼ˆæ”¯æŒrunnerã€statusã€pageã€limitè¿‡æ»¤ï¼‰ |
| `/api/test-records/:id` | GET | è·å–å•æ¡æµ‹è¯•è®°å½•è¯¦æƒ… |
| `/api/test-records/:id` | DELETE | åˆ é™¤æŒ‡å®šæµ‹è¯•è®°å½• |
| `/api/test-records/clear` | POST | æ¸…ç©ºæµ‹è¯•è®°å½•ï¼ˆæ”¯æŒrunnerã€statusæ¡ä»¶ç­›é€‰ï¼‰ |
| `/api/test-records/stats` | GET | è·å–æµ‹è¯•ç»Ÿè®¡ä¿¡æ¯ |

### Perfcat é›†æˆ API

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/perfcat` | GET | è·å–Perfcaté…ç½®çŠ¶æ€ |
| `/api/perfcat` | POST | è®¾ç½®Perfcaté…ç½®ï¼ˆURLå’ŒCookieï¼‰ |
| `/api/perfcat/test` | POST | æµ‹è¯•Perfcatä¸Šä¼ åŠŸèƒ½ |

### æŠ¥å‘Šç®¡ç† API

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/reports` | GET | è·å–æŠ¥å‘Šåˆ—è¡¨ |
| `/api/reports/:filename` | DELETE | åˆ é™¤æŒ‡å®šæŠ¥å‘Šæ–‡ä»¶ |
| `/reports/*` | GET | è®¿é—®æŠ¥å‘Šæ–‡ä»¶ï¼ˆé™æ€æ–‡ä»¶æœåŠ¡ï¼‰ |

### å®‰å…¨ API

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/api-keys` | GET | è·å–æ‰€æœ‰APIå¯†é’¥ï¼ˆéœ€APIå¯†é’¥è®¤è¯ï¼‰ |
| `/api/api-keys` | POST | ç”Ÿæˆæ–°çš„APIå¯†é’¥ |
| `/api/api-keys` | DELETE | åˆ é™¤æŒ‡å®šAPIå¯†é’¥ |
| `/api/webhook` | GET | è·å–Webhooké…ç½® |
| `/api/webhook` | POST | è®¾ç½®Webhook URL |

> ğŸ“– è¯¦ç»† API æ–‡æ¡£å’Œç¤ºä¾‹è¯·å‚è€ƒ [USAGE_GUIDE.md](USAGE_GUIDE.md)

## ğŸ“ é¡¹ç›®ç»“æ„

```text
benchmark/
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ index.ts              # Express æœåŠ¡å™¨ä¸»æ–‡ä»¶ï¼ˆ2900+ è¡Œï¼‰
â”‚   â””â”€â”€ testcase-storage.ts  # æµ‹è¯•ç”¨ä¾‹å­˜å‚¨ç®¡ç†
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html            # ä¸»ç•Œé¢ - æµ‹è¯•ç”¨ä¾‹ç®¡ç†
â”‚   â”œâ”€â”€ records.html          # æµ‹è¯•è®°å½•æŸ¥çœ‹ç•Œé¢
â”‚   â”œâ”€â”€ debug.html            # API è°ƒè¯•å·¥å…·
â”‚   â”œâ”€â”€ test-console.html     # æ§åˆ¶å°è¯Šæ–­å·¥å…·
â”‚   â””â”€â”€ simple-test.html      # ç®€å•æµ‹è¯•é¡µé¢
â”œâ”€â”€ benchmark_report/         # æµ‹è¯•æŠ¥å‘Šå­˜å‚¨ç›®å½•
â”œâ”€â”€ usr_data/                 # ç”¨æˆ·æ•°æ®ç›®å½•ï¼ˆæµè§ˆå™¨é…ç½®æ–‡ä»¶ç­‰ï¼‰
â”œâ”€â”€ testcases.json            # æµ‹è¯•ç”¨ä¾‹æ•°æ®ï¼ˆæœåŠ¡å™¨æŒä¹…åŒ–ï¼‰
â”œâ”€â”€ test-records.json         # æµ‹è¯•æ‰§è¡Œè®°å½•
â”œâ”€â”€ perfcat-config.json       # Perfcat é…ç½®
â”œâ”€â”€ api-keys.json             # API å¯†é’¥é…ç½®
â”œâ”€â”€ webhook-config.json       # Webhook é…ç½®
â”œâ”€â”€ package.json              # é¡¹ç›®é…ç½®
â”œâ”€â”€ tsconfig.json             # TypeScript é…ç½®
â””â”€â”€ README.md                 # è¯´æ˜æ–‡æ¡£ï¼ˆå½“å‰æ–‡æ¡£ï¼‰
```

## ğŸ“ æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹

### ç¤ºä¾‹ 1: åŸºç¡€æ€§èƒ½æµ‹è¯•

```json
{
  "name": "Bç«™é¦–é¡µæ€§èƒ½æµ‹è¯•",
  "description": "æµ‹è¯•Bç«™é¦–é¡µçš„åŠ è½½å’Œè¿è¡Œæ—¶æ€§èƒ½",
  "runners": {
    "Initialization": { "enabled": true, "iterations": 3 },
    "Runtime": { "enabled": true, "durationMs": 60000, "delayMs": 10000 }
  },
  "urlsWithDesc": [
    {
      "url": "https://www.bilibili.com",
      "description": "Bç«™é¦–é¡µ"
    }
  ],
  "mode": "headless",
  "repeatCount": 1,
  "anonymous": true,
  "cpuThrottling": 1,
  "tags": ["bilibili", "é¦–é¡µ", "æ€§èƒ½"]
}
```

### ç¤ºä¾‹ 2: Per-URLé…ç½® - ç™»å½•å‰åå¯¹æ¯”

```json
{
  "name": "ç™»å½•çŠ¶æ€å¯¹æ¯”æµ‹è¯•",
  "urlsWithDesc": [
    {
      "url": "https://www.bilibili.com",
      "description": "æ¸¸å®¢æ¨¡å¼",
      "config": {
        "cookie": ""
      }
    },
    {
      "url": "https://www.bilibili.com",
      "description": "ç™»å½•æ¨¡å¼",
      "config": {
        "cookie": "your_cookie_string_here"
      }
    }
  ],
  "runners": {
    "Runtime": { "enabled": true, "durationMs": 60000, "delayMs": 10000 }
  }
}
```

### ç¤ºä¾‹ 3: ç½‘ç»œæ¡ä»¶æ¨¡æ‹Ÿ

```json
{
  "name": "å¼±ç½‘ç¯å¢ƒæµ‹è¯•",
  "urlsWithDesc": [
    {
      "url": "https://www.bilibili.com",
      "description": "4Gç½‘ç»œ",
      "config": {
        "networkConditions": {
          "downloadThroughput": 4000000,
          "uploadThroughput": 3000000,
          "latency": 20
        }
      }
    },
    {
      "url": "https://www.bilibili.com",
      "description": "3Gç½‘ç»œ",
      "config": {
        "networkConditions": {
          "downloadThroughput": 1600000,
          "uploadThroughput": 750000,
          "latency": 150
        }
      }
    }
  ]
}
```

### ç¤ºä¾‹ 4: ç”Ÿå‘½å‘¨æœŸé’©å­

```json
{
  "name": "é¡µé¢äº¤äº’æµ‹è¯•",
  "urlsWithDesc": [
    {
      "url": "https://www.bilibili.com/video/BV1xx411c7Xg",
      "description": "è§†é¢‘é¡µé¢",
      "config": {
        "hooks": {
          "onPageLoaded": "await page.waitForSelector('.bpx-player-container');",
          "onPageTesting": "await page.click('.bpx-player-primary-area'); await page.waitForTimeout(5000);"
        }
      }
    }
  ],
  "runners": {
    "Runtime": { "enabled": true, "durationMs": 30000, "delayMs": 5000 }
  }
}
```

> ğŸ“– æ›´å¤šç¤ºä¾‹è¯·å‚è€ƒ [PRESET_SYSTEM_GUIDE.md](PRESET_SYSTEM_GUIDE.md) å’Œ [BILIBILI_LIVE_PRESETS.md](BILIBILI_LIVE_PRESETS.md)

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **åç«¯**: Express.js + TypeScript + Node.js 18+
- **å‰ç«¯**: åŸç”Ÿ HTML/CSS/JavaScriptï¼ˆæ— æ¡†æ¶ä¾èµ–ï¼‰
- **å®æ—¶é€šä¿¡**: WebSocket (wsåº“)
- **æ•°æ®å‹ç¼©**: LZ-String
- **æµ‹è¯•å¼•æ“**: @bilibili-player/benchmark (Bç«™å†…éƒ¨å·¥å…·)
- **è¿›ç¨‹ç®¡ç†**: child_process (Node.jsåŸç”Ÿ)

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¾èµ–è¦æ±‚**: ç¡®ä¿å·²å®‰è£… `@bilibili-player/benchmark` åŒ…ï¼ˆå‚è€ƒ [INSTALL.md](INSTALL.md)ï¼‰
2. **å¹¶å‘æ§åˆ¶**: æ”¯æŒå¤šä¸ªæµ‹è¯•ä»»åŠ¡å¹¶å‘æ‰§è¡Œï¼Œæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹å¯ç‹¬ç«‹è¿è¡Œ
3. **æ•°æ®æŒä¹…åŒ–**:
   - æµ‹è¯•ç”¨ä¾‹ä¿å­˜åœ¨ `testcases.json`
   - æ‰§è¡Œè®°å½•ä¿å­˜åœ¨ `test-records.json`
   - æŠ¥å‘Šæ–‡ä»¶ä¿å­˜åœ¨ `benchmark_report/` ç›®å½•
4. **æµè§ˆå™¨æ•°æ®**: æ¯ä¸ªä»»åŠ¡åœ¨ `usr_data/` ç›®å½•ä¸‹åˆ›å»ºç‹¬ç«‹çš„æµè§ˆå™¨é…ç½®æ–‡ä»¶
5. **ç«¯å£é…ç½®**: é»˜è®¤ç«¯å£3000ï¼Œå¯é€šè¿‡ç¯å¢ƒå˜é‡ `PORT` ä¿®æ”¹
6. **å®‰å…¨å»ºè®®**: ç”Ÿäº§ç¯å¢ƒå»ºè®®å¯ç”¨APIå¯†é’¥è®¤è¯

## ğŸ”§ æ•…éšœæ’æŸ¥

### ç«¯å£è¢«å ç”¨

æ–¹æ³• 1: ä½¿ç”¨ç¯å¢ƒå˜é‡ä¿®æ”¹ç«¯å£

```bash
PORT=3001 npm run dev
```

æ–¹æ³• 2: ä¿®æ”¹ [server/index.ts:16](server/index.ts#L16)

```typescript
const PORT = process.env.PORT ? parseInt(process.env.PORT) : 3000;
```

### ä¾èµ–å®‰è£…å¤±è´¥

å°è¯•æ¸…é™¤ç¼“å­˜åé‡æ–°å®‰è£…:

```bash
rm -rf node_modules package-lock.json
npm install
```

å¦‚æœ `@bilibili-player/benchmark` å®‰è£…å¤±è´¥ï¼Œè¯·å‚è€ƒ [INSTALL.md](INSTALL.md)

### WebSocketè¿æ¥å¤±è´¥

æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Œç¡®ä¿å…è®¸WebSocketè¿æ¥ã€‚å¦‚æœä½¿ç”¨åå‘ä»£ç†ï¼Œéœ€è¦é…ç½®WebSocketæ”¯æŒã€‚

### æµ‹è¯•æ— æ³•å¯åŠ¨

1. æ£€æŸ¥ `testcases.json` æ ¼å¼æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤æµ‹è¯•ç”¨ä¾‹é…ç½®å®Œæ•´ï¼ˆå¿…é¡»åŒ…å«nameã€runnersã€urlsWithDescï¼‰
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°å’ŒæœåŠ¡å™¨æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

æ›´å¤šé—®é¢˜è¯·å‚è€ƒ [TROUBLESHOOTING.md](TROUBLESHOOTING.md)

## ğŸ“š ç›¸å…³èµ„æº

- [é¡¹ç›®ä»“åº“](https://github.com/your-repo/benchmark-web-server)
- [é—®é¢˜åé¦ˆ](https://github.com/your-repo/benchmark-web-server/issues)
- [@bilibili-player/benchmark æ–‡æ¡£](https://www.npmjs.com/package/@bilibili-player/benchmark)

## ğŸ“„ License

MIT License - è¯¦è§ LICENSE æ–‡ä»¶

---

**ğŸš€ å¼€å§‹ä½¿ç”¨**: è¿è¡Œ `./deploy.sh` (Mac/Linux) æˆ– `deploy.bat` (Windows) ä¸€é”®å¯åŠ¨ï¼
