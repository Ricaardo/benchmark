---
title: 常用配置( 社区沉淀#滑稽 )
sidebar_position: 4
---

## 连续 hover inline 播放器

```typescript twoslash
import type { UserOptions } from "@bilibili-player/benchmark";

const config: UserOptions = {
    cpuThrottlingRate: 2,
    runners: {
        Runtime: {
            durationMs: 60_000,
            testCases: [
                {
                    target: "https://www.bilibili.com",
                    description: "B站首页",
                    async onPageTesting({ page }) {
                        const feedCard = page.locator(`.feed-card .bili-video-card__image--link:not([href*="cm.bilibili.com"])`);
                        for (let i = 0; i < 8; ++i) {
                            await feedCard.nth(i).hover();
                            await page.waitForTimeout(3000);
                        }
                            // 单纯找一个元素把鼠标移过去而已( 否则会一直hover在最后一个feed卡片上 )
                        const feedRoll = page.locator(".feed-roll-btn");
                        await feedRoll.hover();
                    },
                }
            ],
        }
    }
};

export default config;
```


## 模拟 offline

```ts twoslash
import type { UserOptions } from "@bilibili-player/benchmark";

const config: UserOptions = {
    runners: {
        Runtime: {
            durationMs: 30_000,
            delayMs: 15_000,
            testCases: [
                {
                    target: "https://www.bilibili.com",
                    description: "B站首页",
                    async onPageLoaded({ page, session }) {
                        await session.send("Network.emulateNetworkConditions", {
                            connectionType: "none",
                            downloadThroughput: 0,
                            latency: 0,
                            offline: true,
                            uploadThroughput: 0,
                        });
                    }
                }
            ]
        }
    }
};

export default config;
```

## 滚动20次, 每次都 hover 出 popover

```typescript twoslash
import type { UserOptions } from "@bilibili-player/benchmark";

const config: UserOptions = {
    cpuThrottlingRate: 2,
    runners: {
        Runtime: {
            durationMs: 240_000,
            testCases: [
                {
                    target: "https://www.bilibili.com",
                    description: "only scroll",
                    async onPageTesting({ page }) {
                        for (let i = 0; i < 20; ++i) {
                            await page.evaluate(() => {
                                window.scrollTo({
                                    top: document.documentElement.scrollHeight,
                                    behavior: "smooth"
                                });
                            });
                            await page.waitForTimeout(3000);
                            // below 6s is more aligning the time of 6 popovers
                            await page.waitForTimeout(6000);
                        }
                    }
                },
                {
                    target: "https://www.bilibili.com",
                    description: "scroll + popover",
                    async onPageTesting({ page }) {
                        for (let i = 0; i < 20; ++i) {
                            await page.evaluate(() => {
                                window.scrollTo({
                                    top: document.documentElement.scrollHeight,
                                    behavior: "smooth"
                                });
                            });
                            await page.waitForTimeout(3000);
                            const videoCardList = page.locator(".bili-video-card.is-rcmd.enable-no-interest");
                            const count = await videoCardList.count();
                            for (let i = count - 1, times = 0; i >= 0 && times < 6; --i) {
                                const videoCard = videoCardList.nth(i);
                                const popover = videoCard.locator(".bili-video-card__info--no-interest");
                                const isVisible = await videoCard.isVisible();
                                if (!isVisible) {
                                    console.log("continue");
                                    continue;
                                }
                                await videoCard.hover();
                                await popover.hover();
                                await page.waitForTimeout(1000);
                                times++;
                            }
                        }
                    }
                },
            ]
        }
    }
};

export default config;
```

## 模拟浏览器崩溃

```typescript twoslash
import type { UserOptions } from "@bilibili-player/benchmark";
const config: UserOptions = {
    cpuThrottlingRate: 2,
    __internal__: {
        chromeFlags: [
            "--js-flags=--max-old-space-size=128", // 单位为MB，限制单tab的最大内存使用
        ]
    },
    runners: {
        Runtime: {
            durationMs: 1 * 15 * 1000,
            delayMs: 2000,
            testCases: [
                {
                    target: "https://www.bilibili.com",
                    description: "crash1",
                    onPageLoaded: () => {
                        setTimeout(() => {
                            const bigArray = new Array(512 * 1024 * 1024).fill("A");
                            const bigArray2 = new Array(512 * 1024 * 1024).fill("A");
                            const bigArray3 = new Array(512 * 1024 * 1024).fill("A");
                            const bigArray4 = new Array(512 * 1024 * 1024).fill("A");
                            const bigArray5 = new Array(512 * 1024 * 1024).fill("A");
                        }, 7000);
                    },
                },
                {
                    target: "chrome://crash",
                    description: "crash2",
                }
            ]
        }
    }
};

export default config;
```