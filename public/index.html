<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Benchmark Web Runner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.85em;
        }

        .status-idle {
            background: #e0e0e0;
            color: #666;
        }

        .status-running {
            background: #ffd54f;
            color: #f57c00;
            animation: pulse 2s infinite;
        }

        .status-completed {
            background: #81c784;
            color: #2e7d32;
        }

        .status-error {
            background: #e57373;
            color: #c62828;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            position: relative;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: #e57373;
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #ef5350;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(229, 115, 115, 0.4);
        }

        .btn-warning {
            background: #ffa726;
            color: white;
        }

        .btn-warning:hover:not(:disabled) {
            background: #fb8c00;
        }

        .btn-secondary {
            background: #90a4ae;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #78909c;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85em;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        button.loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            right: 8px;
            margin-top: -8px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .output-box {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-top: 15px;
        }

        .test-case-item {
            background: white;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            border: 1px solid #e0e0e0;
        }

        .test-case-item input {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .test-case-item input.error {
            border-color: #e57373;
        }

        .test-case-item label {
            display: block;
            margin-top: 8px;
            color: #555;
            font-weight: 500;
            font-size: 0.9em;
        }

        .test-case-item button {
            margin-top: 8px;
            padding: 6px 12px;
            font-size: 0.85em;
        }

        .error-message {
            color: #e57373;
            font-size: 0.85em;
            margin-top: 5px;
        }

        /* Toasté€šçŸ¥ç³»ç»Ÿ */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
        }

        .toast {
            background: white;
            padding: 16px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin-bottom: 10px;
            min-width: 300px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            border-left: 4px solid #81c784;
        }

        .toast.error {
            border-left: 4px solid #e57373;
        }

        .toast.warning {
            border-left: 4px solid #ffa726;
        }

        .toast.info {
            border-left: 4px solid #64b5f6;
        }

        .toast-icon {
            font-size: 1.5em;
        }

        .toast-message {
            flex: 1;
            color: #333;
        }

        .reports-list {
            list-style: none;
        }

        .reports-list li {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .reports-list li:last-child {
            border-bottom: none;
        }

        .reports-list a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            flex: 1;
        }

        .reports-list a:hover {
            text-decoration: underline;
        }

        .report-date {
            color: #999;
            font-size: 0.85em;
            margin-right: 10px;
        }

        .report-size {
            color: #999;
            font-size: 0.85em;
            margin-right: 10px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #999;
        }

        /* è¿›åº¦æ¡æ ·å¼ */
        .progress-container {
            margin-top: 15px;
            background: #2d2d2d;
            border-radius: 8px;
            padding: 15px;
            display: none;
        }

        .progress-container.active {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #1e1e1e;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin-bottom: 10px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9em;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            color: #d4d4d4;
            font-size: 0.9em;
        }

        .progress-info strong {
            color: #fff;
        }

        /* æ·±è‰²æ¨¡å¼ */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        body.dark-mode .card {
            background: #2d2d2d;
            color: #e0e0e0;
        }

        body.dark-mode .card h2 {
            color: #fff;
            border-bottom-color: #667eea;
        }

        body.dark-mode .output-box {
            background: #1a1a1a;
            color: #d4d4d4;
        }

        body.dark-mode input,
        body.dark-mode select,
        body.dark-mode textarea {
            background: #3d3d3d;
            color: #e0e0e0;
            border-color: #555;
        }

        body.dark-mode .test-case-item {
            background: #3d3d3d;
            border-color: #555;
        }

        /* æ·±è‰²æ¨¡å¼åˆ‡æ¢æŒ‰é’® */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        body.dark-mode .theme-toggle {
            background: rgba(45, 45, 45, 0.9);
        }

        /* é˜Ÿåˆ—çŠ¶æ€æ ·å¼ */
        .queue-container {
            margin-top: 15px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
            display: none;
        }

        .queue-container.active {
            display: block;
        }

        body.dark-mode .queue-container {
            background: #2d2d2d;
        }

        .queue-item {
            padding: 10px;
            background: white;
            margin-bottom: 8px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        body.dark-mode .queue-item {
            background: #3d3d3d;
        }

        .queue-item.completed {
            border-left-color: #81c784;
            opacity: 0.7;
        }

        .queue-item.error {
            border-left-color: #e57373;
        }

        .queue-item.running {
            border-left-color: #ffd54f;
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢æ·±è‰²æ¨¡å¼">ğŸŒ™</button>
    <div class="toast-container" id="toast-container"></div>

    <div class="container">
        <div class="header">
            <h1>ğŸš€ Benchmark Web Runner</h1>
            <p>Bilibili Player Performance Testing</p>
        </div>

        <div style="text-align: center; margin-bottom: 20px;">
            <a href="/" style="padding: 10px 20px; background: white; color: #667eea; text-decoration: none; border-radius: 6px; font-weight: 600; margin: 0 5px; display: inline-block;">ğŸ  æ§åˆ¶å°</a>
            <a href="/config.html" style="padding: 10px 20px; background: white; color: #667eea; text-decoration: none; border-radius: 6px; font-weight: 600; margin: 0 5px; display: inline-block;">âš™ï¸ é…ç½®ç®¡ç†</a>
        </div>

        <div class="card">
            <h2>æ§åˆ¶é¢æ¿</h2>
            <div style="margin-bottom: 15px;">
                <strong>å½“å‰çŠ¶æ€:</strong>
                <span id="status-badge" class="status-badge status-idle">IDLE</span>
                <span id="current-runner" style="margin-left: 10px; color: #666;"></span>
            </div>
            <div style="margin-bottom: 15px;">
                <strong>é€‰æ‹©æµ‹è¯•æ¨¡å¼:</strong>
                <select id="runner-select" style="margin-left: 10px; padding: 8px 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 1em; background: white;">
                    <option value="Initialization">Initialization - åˆå§‹åŒ–æ€§èƒ½æµ‹è¯•</option>
                    <option value="Runtime" selected>Runtime - è¿è¡Œæ—¶æ€§èƒ½æµ‹è¯•</option>
                    <option value="MemoryLeak">MemoryLeak - å†…å­˜æ³„æ¼æµ‹è¯•</option>
                </select>
            </div>
            <div class="button-group">
                <button id="start-btn" class="btn-primary" onclick="startBenchmark()">
                    â–¶ï¸ å¯åŠ¨æµ‹è¯•
                </button>
                <button id="stop-btn" class="btn-danger" onclick="stopBenchmark()" disabled>
                    â¹ï¸ åœæ­¢æµ‹è¯•
                </button>
                <button class="btn-secondary" onclick="refreshStatus()">
                    ğŸ”„ åˆ·æ–°çŠ¶æ€
                </button>
                <button class="btn-warning" onclick="resetStatus()">
                    ğŸ”§ å¼ºåˆ¶é‡ç½®
                </button>
            </div>
            <div style="margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 6px; font-size: 0.9em;">
                <strong>æµ‹è¯•æ¨¡å¼è¯´æ˜:</strong>
                <ul style="margin: 10px 0 0 20px; line-height: 1.8;">
                    <li><strong>Initialization:</strong> æµ‹è¯•é¡µé¢åˆå§‹åŒ–åŠ è½½æ€§èƒ½</li>
                    <li><strong>Runtime:</strong> æµ‹è¯•é¡µé¢è¿è¡Œæ—¶é•¿æ—¶é—´æ€§èƒ½è¡¨ç°</li>
                    <li><strong>MemoryLeak:</strong> æ£€æµ‹é¡µé¢å†…å­˜æ³„æ¼é—®é¢˜</li>
                </ul>
            </div>
            <div style="margin-top: 15px; padding: 12px; background: #e3f2fd; border-left: 4px solid #64b5f6; border-radius: 4px; font-size: 0.9em;">
                <strong>ğŸ’¡ å¿«æ·é”®ï¼š</strong>
                <span style="color: #1976d2;">æŒ‰ä¸‹ Ctrl/Cmd + Enter å¿«é€Ÿå¯åŠ¨æµ‹è¯• | Ctrl/Cmd + S ä¿å­˜é…ç½®</span>
            </div>

            <!-- æµ‹è¯•é˜Ÿåˆ—æ˜¾ç¤º -->
            <div class="queue-container" id="queue-container">
                <h3 style="margin: 0 0 10px 0; color: #333; font-size: 1em;">ğŸ“‹ æµ‹è¯•é˜Ÿåˆ—</h3>
                <div id="queue-list"></div>
            </div>
        </div>

        <div class="card" style="border: 2px solid #667eea;">
            <h2 style="color: #667eea;">âš™ï¸ å¿«é€Ÿé…ç½®</h2>

            <!-- é…ç½®é¢„è®¾é€‰æ‹©å™¨ -->
            <div style="background: #f0f4ff; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #667eea;">
                <h3 style="margin: 0 0 15px 0; color: #333; font-size: 1.1em;">âœ¨ é…ç½®é¢„è®¾</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px;" id="preset-buttons">
                    <button class="btn-primary" onclick="applyPreset('quick-test')" style="text-align: left; padding: 15px;">
                        <strong style="display: block; margin-bottom: 5px;">âš¡ å¿«é€Ÿæµ‹è¯•</strong>
                        <small style="opacity: 0.9;">1åˆ†é’Ÿå®Œæˆï¼Œå¿«é€ŸéªŒè¯</small>
                    </button>
                    <button class="btn-primary" onclick="applyPreset('standard-test')" style="text-align: left; padding: 15px;">
                        <strong style="display: block; margin-bottom: 5px;">ğŸ“Š æ ‡å‡†æµ‹è¯•</strong>
                        <small style="opacity: 0.9;">5åˆ†é’Ÿï¼Œæ ‡å‡†æ€§èƒ½æµ‹è¯•</small>
                    </button>
                    <button class="btn-primary" onclick="applyPreset('full-test')" style="text-align: left; padding: 15px;">
                        <strong style="display: block; margin-bottom: 5px;">ğŸš€ å®Œæ•´æµ‹è¯•</strong>
                        <small style="opacity: 0.9;">æ‰€æœ‰æ¨¡å¼ï¼Œå…¨é¢æ£€æµ‹</small>
                    </button>
                    <button class="btn-primary" onclick="applyPreset('memory-focus')" style="text-align: left; padding: 15px;">
                        <strong style="display: block; margin-bottom: 5px;">ğŸ” å†…å­˜ä¸“é¡¹</strong>
                        <small style="opacity: 0.9;">ä¸“æ³¨æ£€æµ‹å†…å­˜æ³„æ¼</small>
                    </button>
                </div>
                <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 4px; font-size: 0.9em; color: #666;">
                    ğŸ’¡ <strong>æç¤ºï¼š</strong>ç‚¹å‡»é¢„è®¾æŒ‰é’®ä¸€é”®åº”ç”¨é…ç½®ï¼Œç„¶åå¯åœ¨ä¸‹æ–¹å¾®è°ƒå‚æ•°
                </div>
            </div>

            <!-- Initialization é…ç½® -->
            <div id="init-quick-config" style="display: none; background: #f5f5f5; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <h3 style="margin-bottom: 10px; color: #333;">ğŸš€ Initialization é…ç½®</h3>
                <div id="init-test-cases-quick"></div>
                <button class="btn-secondary" style="margin-top: 10px; padding: 8px 16px; font-size: 0.9em;" onclick="addQuickTestCase('Initialization')">â• æ·»åŠ æµ‹è¯•ç”¨ä¾‹</button>
            </div>

            <!-- Runtime é…ç½® -->
            <div id="runtime-quick-config" style="display: none; background: #f5f5f5; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <h3 style="margin-bottom: 10px; color: #333;">â±ï¸ Runtime é…ç½®</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: #555; font-weight: 500;">è¿è¡Œæ—¶é•¿ (æ¯«ç§’)</label>
                        <input type="number" id="runtime-duration-quick" value="60000" step="1000" style="width: 100%; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: #555; font-weight: 500;">å»¶è¿Ÿæ—¶é—´ (æ¯«ç§’)</label>
                        <input type="number" id="runtime-delay-quick" value="10000" step="1000" style="width: 100%; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px;">
                    </div>
                </div>
                <div id="runtime-test-cases-quick"></div>
                <button class="btn-secondary" style="margin-top: 10px; padding: 8px 16px; font-size: 0.9em;" onclick="addQuickTestCase('Runtime')">â• æ·»åŠ æµ‹è¯•ç”¨ä¾‹</button>
            </div>

            <!-- MemoryLeak é…ç½® -->
            <div id="memory-quick-config" style="display: none; background: #f5f5f5; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <h3 style="margin-bottom: 10px; color: #333;">ğŸ” MemoryLeak é…ç½®</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: #555; font-weight: 500;">è¿­ä»£é—´éš” (æ¯«ç§’)</label>
                        <input type="number" id="memory-interval-quick" value="60000" step="1000" style="width: 100%; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: #555; font-weight: 500;">è¿­ä»£æ¬¡æ•°</label>
                        <input type="number" id="memory-iterations-quick" value="3" min="2" max="10" style="width: 100%; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px;">
                    </div>
                </div>
                <div id="memory-test-cases-quick"></div>
                <button class="btn-secondary" style="margin-top: 10px; padding: 8px 16px; font-size: 0.9em;" onclick="addQuickTestCase('MemoryLeak')">â• æ·»åŠ æµ‹è¯•ç”¨ä¾‹</button>
            </div>

            <div class="button-group" style="margin-top: 15px;">
                <button class="btn-primary" onclick="saveQuickConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
                <button class="btn-secondary" onclick="loadQuickConfig()">ğŸ”„ é‡æ–°åŠ è½½</button>
                <button class="btn-secondary" onclick="exportConfig()">ğŸ“¤ å¯¼å‡ºé…ç½®</button>
                <button class="btn-secondary" onclick="importConfig()">ğŸ“¥ å¯¼å…¥é…ç½®</button>
            </div>

            <div style="margin-top: 15px; padding: 12px; background: #e3f2fd; border-left: 4px solid #667eea; border-radius: 4px;">
                <strong style="color: #1565c0;">ğŸ’¡ æç¤ºï¼š</strong>
                <span style="color: #1565c0;">åœ¨è¿™é‡Œå¿«é€Ÿé…ç½®ï¼Œæˆ–å‰å¾€ <a href="/config.html" style="color: #1565c0; font-weight: 600;">é…ç½®ç®¡ç†é¡µé¢</a> è¿›è¡Œé«˜çº§é…ç½®ã€‚</span>
            </div>
        </div>

        <div class="card">
            <h2>å®æ—¶è¾“å‡º</h2>

            <!-- è¿›åº¦æ¡ -->
            <div class="progress-container" id="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%">0%</div>
                </div>
                <div class="progress-info">
                    <div>
                        <strong>å½“å‰è¿›åº¦:</strong> <span id="progress-current">0/0</span>
                    </div>
                    <div>
                        <strong>é¢„è®¡å‰©ä½™:</strong> <span id="progress-eta">è®¡ç®—ä¸­...</span>
                    </div>
                    <div>
                        <strong>å·²ç”¨æ—¶é—´:</strong> <span id="progress-elapsed">00:00</span>
                    </div>
                </div>
            </div>

            <div id="output" class="output-box">ç­‰å¾…å¯åŠ¨æµ‹è¯•...</div>
        </div>

        <div class="card">
            <h2>æµ‹è¯•æŠ¥å‘Š</h2>
            <div id="reports" class="loading">åŠ è½½ä¸­...</div>
        </div>
    </div>

    <script>
        // ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ŒåŠ¨æ€è·å– API åœ°å€
        const API_BASE = `${window.location.origin}/api`;
        const WS_URL = `ws://${window.location.host}`;
        let ws = null;
        let reconnectInterval = null;
        let currentConfig = null;

        // é…ç½®é¢„è®¾æ¨¡æ¿
        const CONFIG_PRESETS = {
            'quick-test': {
                name: 'âš¡ å¿«é€Ÿæµ‹è¯•ï¼ˆ1åˆ†é’Ÿï¼‰',
                description: 'å¿«é€ŸéªŒè¯åŠŸèƒ½ï¼Œ1åˆ†é’Ÿå®Œæˆ',
                config: {
                    mode: { anonymous: true, headless: true },
                    runners: {
                        Initialization: { enabled: false, testCases: [] },
                        Runtime: {
                            enabled: true,
                            durationMs: 60000,
                            delayMs: 5000,
                            testCases: [
                                { target: 'https://www.bilibili.com', description: 'Bç«™é¦–é¡µ' }
                            ]
                        },
                        MemoryLeak: { enabled: false, testCases: [], intervalMs: 60000, iterations: 3, onPageTesting: '' }
                    }
                }
            },
            'standard-test': {
                name: 'ğŸ“Š æ ‡å‡†æµ‹è¯•ï¼ˆ5åˆ†é’Ÿï¼‰',
                description: 'æ ‡å‡†æ€§èƒ½æµ‹è¯•ï¼ŒåŒ…å«Runtime',
                config: {
                    mode: { anonymous: true, headless: false },
                    runners: {
                        Initialization: { enabled: false, testCases: [] },
                        Runtime: {
                            enabled: true,
                            durationMs: 300000,
                            delayMs: 10000,
                            testCases: [
                                { target: 'https://www.bilibili.com', description: 'Bç«™é¦–é¡µ' },
                                { target: 'https://live.bilibili.com', description: 'Bç«™ç›´æ’­' }
                            ]
                        },
                        MemoryLeak: { enabled: false, testCases: [], intervalMs: 60000, iterations: 3, onPageTesting: '' }
                    }
                }
            },
            'full-test': {
                name: 'ğŸš€ å®Œæ•´æµ‹è¯•ï¼ˆæ‰€æœ‰æ¨¡å¼ï¼‰',
                description: 'åŒ…å«æ‰€æœ‰æµ‹è¯•ç±»å‹ï¼Œå…¨é¢æ£€æµ‹',
                config: {
                    mode: { anonymous: true, headless: false },
                    runners: {
                        Initialization: {
                            enabled: true,
                            testCases: [
                                { target: 'https://www.bilibili.com', description: 'Bç«™é¦–é¡µ' }
                            ]
                        },
                        Runtime: {
                            enabled: true,
                            durationMs: 180000,
                            delayMs: 10000,
                            testCases: [
                                { target: 'https://www.bilibili.com', description: 'Bç«™é¦–é¡µ' }
                            ]
                        },
                        MemoryLeak: {
                            enabled: true,
                            intervalMs: 60000,
                            iterations: 3,
                            onPageTesting: '',
                            testCases: [
                                { target: 'https://www.bilibili.com', description: 'Bç«™é¦–é¡µ' }
                            ]
                        }
                    }
                }
            },
            'memory-focus': {
                name: 'ğŸ” å†…å­˜æ³„æ¼ä¸“é¡¹',
                description: 'ä¸“æ³¨æ£€æµ‹å†…å­˜æ³„æ¼é—®é¢˜',
                config: {
                    mode: { anonymous: true, headless: false },
                    runners: {
                        Initialization: { enabled: false, testCases: [] },
                        Runtime: { enabled: false, testCases: [], durationMs: 60000, delayMs: 10000 },
                        MemoryLeak: {
                            enabled: true,
                            intervalMs: 90000,
                            iterations: 5,
                            onPageTesting: '',
                            testCases: [
                                { target: 'https://www.bilibili.com', description: 'Bç«™é¦–é¡µ' },
                                { target: 'https://live.bilibili.com', description: 'Bç«™ç›´æ’­' }
                            ]
                        }
                    }
                }
            }
        };

        // WebSocket è¿æ¥ç®¡ç†
        function connectWebSocket() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                return; // å·²ç»è¿æ¥
            }

            ws = new WebSocket(WS_URL);

            ws.onopen = () => {
                console.log('WebSocket connected');
                // æ¸…é™¤é‡è¿å®šæ—¶å™¨
                if (reconnectInterval) {
                    clearInterval(reconnectInterval);
                    reconnectInterval = null;
                }
            };

            ws.onmessage = (event) => {
                try {
                    const message = JSON.parse(event.data);

                    if (message.type === 'status') {
                        // å®æ—¶æ›´æ–°UI
                        updateUI(message.data);
                    }
                } catch (error) {
                    console.error('Error parsing WebSocket message:', error);
                }
            };

            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
            };

            ws.onclose = () => {
                console.log('WebSocket disconnected');
                ws = null;

                // è‡ªåŠ¨é‡è¿
                if (!reconnectInterval) {
                    reconnectInterval = setInterval(() => {
                        console.log('Attempting to reconnect...');
                        connectWebSocket();
                    }, 3000);
                }
            };
        }

        // Toast é€šçŸ¥ç³»ç»Ÿ
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            const icons = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸',
                info: 'â„¹ï¸'
            };

            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || icons.info}</div>
                <div class="toast-message">${message}</div>
            `;

            container.appendChild(toast);

            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // URLéªŒè¯
        function isValidURL(url) {
            try {
                new URL(url);
                return true;
            } catch {
                return false;
            }
        }

        // æ·»åŠ æŒ‰é’®åŠ è½½çŠ¶æ€
        function setButtonLoading(button, loading) {
            if (loading) {
                button.disabled = true;
                button.classList.add('loading');
                button.dataset.originalText = button.textContent;
                button.textContent = button.textContent.replace(/^[^\s]+\s/, 'â³ ');
            } else {
                button.disabled = false;
                button.classList.remove('loading');
                if (button.dataset.originalText) {
                    button.textContent = button.dataset.originalText;
                }
            }
        }

        // å¯åŠ¨æµ‹è¯•
        async function startBenchmark() {
            const startBtn = document.getElementById('start-btn');
            setButtonLoading(startBtn, true);

            // é‡ç½®è¿›åº¦
            resetProgress();

            try {
                const runner = document.getElementById('runner-select').value;

                // æ˜¾ç¤ºæµ‹è¯•é˜Ÿåˆ—
                showTestQueue(runner);

                const response = await fetch(`${API_BASE}/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ runner })
                });
                const data = await response.json();

                if (data.success) {
                    showToast(`æµ‹è¯•å·²å¯åŠ¨ï¼š${runner}`, 'success');
                    // WebSocket ä¼šè‡ªåŠ¨æ¨é€æ›´æ–°ï¼Œä¸éœ€è¦è½®è¯¢
                } else {
                    showToast(data.error || 'å¯åŠ¨å¤±è´¥', 'error');
                }
            } catch (error) {
                showToast('å¯åŠ¨æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            } finally {
                setButtonLoading(startBtn, false);
            }
        }

        // åœæ­¢æµ‹è¯•
        async function stopBenchmark() {
            const stopBtn = document.getElementById('stop-btn');
            setButtonLoading(stopBtn, true);

            try {
                const response = await fetch(`${API_BASE}/stop`, { method: 'POST' });
                const data = await response.json();

                if (data.success) {
                    showToast('æµ‹è¯•å·²åœæ­¢', 'warning');
                    // WebSocket ä¼šè‡ªåŠ¨æ¨é€æ›´æ–°
                } else {
                    showToast(data.error || 'åœæ­¢å¤±è´¥', 'error');
                }
            } catch (error) {
                showToast('åœæ­¢æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            } finally {
                setButtonLoading(stopBtn, false);
            }
        }

        // å¼ºåˆ¶é‡ç½®çŠ¶æ€
        async function resetStatus() {
            if (!confirm('ç¡®å®šè¦å¼ºåˆ¶é‡ç½®æ‰€æœ‰çŠ¶æ€å—ï¼Ÿè¿™å°†ç»ˆæ­¢æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„æµ‹è¯•ã€‚')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/reset`, { method: 'POST' });
                const data = await response.json();

                if (data.success) {
                    showToast('çŠ¶æ€å·²é‡ç½®', 'success');
                    // WebSocket ä¼šè‡ªåŠ¨æ¨é€æ›´æ–°
                } else {
                    showToast('é‡ç½®å¤±è´¥', 'error');
                }
            } catch (error) {
                showToast('é‡ç½®å¤±è´¥: ' + error.message, 'error');
            }
        }

        // åˆ·æ–°çŠ¶æ€
        async function refreshStatus() {
            try {
                const response = await fetch(`${API_BASE}/status`);
                const data = await response.json();
                updateUI(data);
            } catch (error) {
                console.error('è·å–çŠ¶æ€å¤±è´¥:', error);
            }
        }

        // æ›´æ–°UI
        function updateUI(data) {
            const badge = document.getElementById('status-badge');
            const startBtn = document.getElementById('start-btn');
            const stopBtn = document.getElementById('stop-btn');
            const output = document.getElementById('output');
            const runnerSelect = document.getElementById('runner-select');
            const currentRunner = document.getElementById('current-runner');

            badge.className = `status-badge status-${data.status}`;
            badge.textContent = data.status.toUpperCase();

            startBtn.disabled = data.status === 'running';
            stopBtn.disabled = data.status !== 'running';
            runnerSelect.disabled = data.status === 'running';

            if (data.currentRunner) {
                currentRunner.textContent = `(${data.currentRunner})`;
            } else {
                currentRunner.textContent = '';
            }

            output.textContent = data.output || 'æš‚æ— è¾“å‡º...';
            output.scrollTop = output.scrollHeight;

            // æ›´æ–°è¿›åº¦
            if (data.output) {
                updateProgress(data.output);
                // æ›´æ–°æµ‹è¯•é˜Ÿåˆ—çŠ¶æ€
                updateQueueFromOutput(data.output);
            }

            // å¦‚æœæµ‹è¯•å®Œæˆæˆ–å‡ºé”™ï¼Œé‡ç½®è¿›åº¦å’Œé˜Ÿåˆ—
            if (data.status === 'completed' || data.status === 'error' || data.status === 'idle') {
                if (progressStartTime > 0) {
                    setTimeout(resetProgress, 3000); // 3ç§’åé‡ç½®è¿›åº¦æ¡
                    setTimeout(hideTestQueue, 3000); // 3ç§’åéšè—é˜Ÿåˆ—
                }
            }
        }

        // WebSocket å·²ç»æ›¿ä»£è½®è¯¢ï¼Œè¿™äº›å‡½æ•°ä¿ç•™ä¸ºç©ºä»¥é˜²æ—§ä»£ç è°ƒç”¨
        function startStatusPolling() {
            // WebSocket è‡ªåŠ¨æ¨é€ï¼Œä¸éœ€è¦è½®è¯¢
        }

        function stopStatusPolling() {
            // WebSocket è‡ªåŠ¨æ¨é€ï¼Œä¸éœ€è¦è½®è¯¢
        }

        // åŠ è½½æŠ¥å‘Šåˆ—è¡¨
        async function loadReports() {
            try {
                const response = await fetch(`${API_BASE}/reports`);
                const reports = await response.json();
                const reportsDiv = document.getElementById('reports');

                if (reports.length === 0) {
                    reportsDiv.innerHTML = '<p class="loading">æš‚æ— æµ‹è¯•æŠ¥å‘Š</p>';
                    return;
                }

                const list = document.createElement('ul');
                list.className = 'reports-list';

                reports.forEach(report => {
                    const li = document.createElement('li');
                    const date = new Date(report.modified).toLocaleString('zh-CN');
                    const size = formatFileSize(report.size);
                    li.innerHTML = `
                        <a href="${report.path}" target="_blank">${report.name}</a>
                        <span class="report-date">${date}</span>
                        <span class="report-size">${size}</span>
                        <button class="btn-danger btn-small" onclick="deleteReport('${report.name}', event)">ğŸ—‘ï¸ åˆ é™¤</button>
                    `;
                    list.appendChild(li);
                });

                reportsDiv.innerHTML = '';
                reportsDiv.appendChild(list);
            } catch (error) {
                document.getElementById('reports').innerHTML =
                    '<p class="loading">åŠ è½½æŠ¥å‘Šå¤±è´¥</p>';
            }
        }

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // åˆ é™¤æŠ¥å‘Š
        async function deleteReport(filename, event) {
            event.preventDefault();
            event.stopPropagation();

            if (!confirm(`ç¡®å®šè¦åˆ é™¤æŠ¥å‘Š "${filename}" å—ï¼Ÿ`)) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/reports/${filename}`, {
                    method: 'DELETE'
                });
                const data = await response.json();

                if (data.success) {
                    showToast('æŠ¥å‘Šå·²åˆ é™¤', 'success');
                    await loadReports();
                } else {
                    showToast('åˆ é™¤å¤±è´¥', 'error');
                }
            } catch (error) {
                showToast('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ·±è‰²æ¨¡å¼åˆ‡æ¢
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const btn = document.querySelector('.theme-toggle');
            const isDark = document.body.classList.contains('dark-mode');
            btn.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        // åˆå§‹åŒ–ä¸»é¢˜
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                const btn = document.querySelector('.theme-toggle');
                if (btn) btn.textContent = 'â˜€ï¸';
            }
        }

        // è¿›åº¦è¿½è¸ª
        let progressStartTime = 0;
        let progressData = {
            current: 0,
            total: 0,
            percentage: 0
        };

        function updateProgress(output) {
            // å°è¯•ä»è¾“å‡ºä¸­è§£æè¿›åº¦ä¿¡æ¯
            // åŒ¹é…ç±»ä¼¼ "Progress: 1/3" æˆ– "Test 2 of 5" çš„æ¨¡å¼
            const patterns = [
                /(?:Progress|æµ‹è¯•è¿›åº¦):\s*(\d+)\s*\/\s*(\d+)/i,
                /Test\s+(\d+)\s+of\s+(\d+)/i,
                /æµ‹è¯•\s*(\d+)\s*\/\s*(\d+)/i,
                /\[(\d+)\/(\d+)\]/
            ];

            let matched = false;
            for (const pattern of patterns) {
                const match = output.match(pattern);
                if (match) {
                    progressData.current = parseInt(match[1]);
                    progressData.total = parseInt(match[2]);
                    progressData.percentage = Math.round((progressData.current / progressData.total) * 100);
                    matched = true;
                    break;
                }
            }

            // å¦‚æœåŒ¹é…åˆ°è¿›åº¦ï¼Œæ˜¾ç¤ºè¿›åº¦æ¡
            const progressContainer = document.getElementById('progress-container');
            const progressFill = document.getElementById('progress-fill');
            const progressCurrent = document.getElementById('progress-current');
            const progressEta = document.getElementById('progress-eta');
            const progressElapsed = document.getElementById('progress-elapsed');

            if (matched && progressData.total > 0) {
                progressContainer.classList.add('active');
                progressFill.style.width = progressData.percentage + '%';
                progressFill.textContent = progressData.percentage + '%';
                progressCurrent.textContent = `${progressData.current}/${progressData.total}`;

                // è®¡ç®—å·²ç”¨æ—¶é—´
                if (progressStartTime === 0) {
                    progressStartTime = Date.now();
                }
                const elapsed = Math.floor((Date.now() - progressStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                progressElapsed.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

                // è®¡ç®—é¢„è®¡å‰©ä½™æ—¶é—´
                if (progressData.current > 0) {
                    const avgTimePerTest = elapsed / progressData.current;
                    const remainingTests = progressData.total - progressData.current;
                    const etaSeconds = Math.floor(avgTimePerTest * remainingTests);
                    const etaMinutes = Math.floor(etaSeconds / 60);
                    const etaSecs = etaSeconds % 60;
                    progressEta.textContent = `${String(etaMinutes).padStart(2, '0')}:${String(etaSecs).padStart(2, '0')}`;
                } else {
                    progressEta.textContent = 'è®¡ç®—ä¸­...';
                }
            } else if (benchmarkStatus === 'idle' || benchmarkStatus === 'completed' || benchmarkStatus === 'error') {
                // æµ‹è¯•æœªè¿è¡Œæˆ–å·²å®Œæˆæ—¶éšè—è¿›åº¦æ¡
                progressContainer.classList.remove('active');
            }
        }

        function resetProgress() {
            progressStartTime = 0;
            progressData = { current: 0, total: 0, percentage: 0 };
            const progressContainer = document.getElementById('progress-container');
            progressContainer.classList.remove('active');
        }

        // æµ‹è¯•é˜Ÿåˆ—ç®¡ç†
        function showTestQueue(runner) {
            if (!currentConfig || !currentConfig.runners[runner]) return;

            const testCases = currentConfig.runners[runner].testCases || [];
            if (testCases.length === 0) return;

            const queueContainer = document.getElementById('queue-container');
            const queueList = document.getElementById('queue-list');

            queueList.innerHTML = '';

            testCases.forEach((tc, index) => {
                const item = document.createElement('div');
                item.className = 'queue-item';
                item.id = `queue-item-${index}`;
                item.innerHTML = `
                    <div>
                        <strong>${index + 1}. ${tc.description || 'æœªå‘½åæµ‹è¯•'}</strong>
                        <div style="font-size: 0.85em; color: #666; margin-top: 3px;">${tc.target}</div>
                    </div>
                    <span class="queue-status" id="queue-status-${index}">â³ ç­‰å¾…ä¸­</span>
                `;
                queueList.appendChild(item);
            });

            queueContainer.classList.add('active');
        }

        function updateQueueItem(index, status) {
            const item = document.getElementById(`queue-item-${index}`);
            const statusSpan = document.getElementById(`queue-status-${index}`);

            if (!item || !statusSpan) return;

            item.classList.remove('pending', 'running', 'completed', 'error');

            switch(status) {
                case 'running':
                    item.classList.add('running');
                    statusSpan.textContent = 'â–¶ï¸ è¿è¡Œä¸­';
                    break;
                case 'completed':
                    item.classList.add('completed');
                    statusSpan.textContent = 'âœ… å®Œæˆ';
                    break;
                case 'error':
                    item.classList.add('error');
                    statusSpan.textContent = 'âŒ å¤±è´¥';
                    break;
                default:
                    statusSpan.textContent = 'â³ ç­‰å¾…ä¸­';
            }
        }

        function hideTestQueue() {
            const queueContainer = document.getElementById('queue-container');
            setTimeout(() => {
                queueContainer.classList.remove('active');
            }, 3000); // 3ç§’åéšè—é˜Ÿåˆ—
        }

        function updateQueueFromOutput(output) {
            // å°è¯•ä»è¾“å‡ºä¸­æ£€æµ‹å½“å‰è¿è¡Œçš„æµ‹è¯•
            // åŒ¹é… "Testing: description" æˆ–ç±»ä¼¼çš„æ¨¡å¼
            const testPatterns = [
                /Testing:\s*(.+)/i,
                /æµ‹è¯•:\s*(.+)/i,
                /Running test:\s*(.+)/i
            ];

            for (const pattern of testPatterns) {
                const match = output.match(pattern);
                if (match && currentConfig) {
                    const runner = currentRunner;
                    if (runner && currentConfig.runners[runner]) {
                        const testCases = currentConfig.runners[runner].testCases || [];
                        testCases.forEach((tc, index) => {
                            if (match[1].includes(tc.description)) {
                                updateQueueItem(index, 'running');
                            }
                        });
                    }
                }
            }

            // æ£€æµ‹æµ‹è¯•å®Œæˆ
            if (output.includes('âœ“') || output.includes('passed') || output.includes('æˆåŠŸ')) {
                // æ ‡è®°æœ€è¿‘è¿è¡Œçš„æµ‹è¯•ä¸ºå®Œæˆ
                if (progressData.current > 0) {
                    updateQueueItem(progressData.current - 1, 'completed');
                }
            }
        }

        // ç›‘å¬ runner é€‰æ‹©å˜åŒ–ï¼Œæ˜¾ç¤ºå¯¹åº”çš„å¿«é€Ÿé…ç½®
        document.addEventListener('DOMContentLoaded', () => {
            const runnerSelect = document.getElementById('runner-select');
            runnerSelect.addEventListener('change', updateQuickConfigVisibility);
            updateQuickConfigVisibility(); // åˆå§‹åŒ–æ˜¾ç¤º
            initTheme(); // åˆå§‹åŒ–ä¸»é¢˜
        });

        function updateQuickConfigVisibility() {
            const runner = document.getElementById('runner-select').value;

            // éšè—æ‰€æœ‰é…ç½®
            document.getElementById('init-quick-config').style.display = 'none';
            document.getElementById('runtime-quick-config').style.display = 'none';
            document.getElementById('memory-quick-config').style.display = 'none';

            // æ˜¾ç¤ºé€‰ä¸­çš„é…ç½®
            if (runner === 'Initialization') {
                document.getElementById('init-quick-config').style.display = 'block';
            } else if (runner === 'Runtime') {
                document.getElementById('runtime-quick-config').style.display = 'block';
            } else if (runner === 'MemoryLeak') {
                document.getElementById('memory-quick-config').style.display = 'block';
            }
        }

        // åŠ è½½å¿«é€Ÿé…ç½®
        async function loadQuickConfig() {
            try {
                const response = await fetch(`${API_BASE}/dynamic-config`);
                currentConfig = await response.json();

                // æ¸²æŸ“ Initialization é…ç½®
                renderQuickTestCases('Initialization', currentConfig.runners.Initialization.testCases || []);

                // æ¸²æŸ“ Runtime é…ç½®
                document.getElementById('runtime-duration-quick').value = currentConfig.runners.Runtime.durationMs || 60000;
                document.getElementById('runtime-delay-quick').value = currentConfig.runners.Runtime.delayMs || 10000;
                renderQuickTestCases('Runtime', currentConfig.runners.Runtime.testCases || []);

                // æ¸²æŸ“ MemoryLeak é…ç½®
                document.getElementById('memory-interval-quick').value = currentConfig.runners.MemoryLeak.intervalMs || 60000;
                document.getElementById('memory-iterations-quick').value = currentConfig.runners.MemoryLeak.iterations || 3;
                renderQuickTestCases('MemoryLeak', currentConfig.runners.MemoryLeak.testCases || []);

            } catch (error) {
                showToast('åŠ è½½é…ç½®å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ¸²æŸ“æµ‹è¯•ç”¨ä¾‹åˆ—è¡¨
        function renderQuickTestCases(runner, testCases) {
            const containerId = runner === 'Initialization' ? 'init-test-cases-quick' :
                               runner === 'Runtime' ? 'runtime-test-cases-quick' :
                               'memory-test-cases-quick';

            const container = document.getElementById(containerId);
            container.innerHTML = '';

            testCases.forEach((tc, index) => {
                const div = document.createElement('div');
                div.className = 'test-case-item';
                div.innerHTML = `
                    <label>æµ‹è¯• URL</label>
                    <input type="text" value="${tc.target || ''}" data-runner="${runner}" data-index="${index}" data-field="target" oninput="validateURL(this)">
                    <div class="error-message" data-error-for="${runner}-${index}-target"></div>
                    <label>æè¿°</label>
                    <input type="text" value="${tc.description || ''}" data-runner="${runner}" data-index="${index}" data-field="description">
                    <button class="btn-danger btn-small" onclick="removeQuickTestCase('${runner}', ${index})">ğŸ—‘ï¸ åˆ é™¤</button>
                `;
                container.appendChild(div);
            });
        }

        // å®æ—¶éªŒè¯ URL
        function validateURL(input) {
            const url = input.value.trim();
            const runner = input.dataset.runner;
            const index = input.dataset.index;
            const errorDiv = document.querySelector(`[data-error-for="${runner}-${index}-target"]`);

            if (url && !isValidURL(url)) {
                input.classList.add('error');
                if (errorDiv) errorDiv.textContent = 'âš ï¸ URL æ ¼å¼æ— æ•ˆ';
            } else {
                input.classList.remove('error');
                if (errorDiv) errorDiv.textContent = '';
            }
        }

        // æ·»åŠ æµ‹è¯•ç”¨ä¾‹
        function addQuickTestCase(runner) {
            if (!currentConfig) return;

            const runnerKey = runner;
            if (!currentConfig.runners[runnerKey].testCases) {
                currentConfig.runners[runnerKey].testCases = [];
            }

            currentConfig.runners[runnerKey].testCases.push({
                target: '',
                description: ''
            });

            renderQuickTestCases(runner, currentConfig.runners[runnerKey].testCases);
        }

        // åˆ é™¤æµ‹è¯•ç”¨ä¾‹
        function removeQuickTestCase(runner, index) {
            if (!currentConfig) return;

            currentConfig.runners[runner].testCases.splice(index, 1);
            renderQuickTestCases(runner, currentConfig.runners[runner].testCases);
        }

        // ä¿å­˜å¿«é€Ÿé…ç½®
        async function saveQuickConfig() {
            if (!currentConfig) {
                showToast('è¯·å…ˆåŠ è½½é…ç½®', 'warning');
                return;
            }

            try {
                // æ”¶é›†è¡¨å•ä¸­çš„ä¿®æ”¹
                const inputs = document.querySelectorAll('.test-case-item input[data-runner]');
                inputs.forEach(input => {
                    const runner = input.dataset.runner;
                    const index = parseInt(input.dataset.index);
                    const field = input.dataset.field;

                    if (currentConfig.runners[runner].testCases[index]) {
                        currentConfig.runners[runner].testCases[index][field] = input.value;
                    }
                });

                // æ”¶é›† Runtime å‚æ•°
                currentConfig.runners.Runtime.durationMs = parseInt(document.getElementById('runtime-duration-quick').value);
                currentConfig.runners.Runtime.delayMs = parseInt(document.getElementById('runtime-delay-quick').value);

                // æ”¶é›† MemoryLeak å‚æ•°
                currentConfig.runners.MemoryLeak.intervalMs = parseInt(document.getElementById('memory-interval-quick').value);
                currentConfig.runners.MemoryLeak.iterations = parseInt(document.getElementById('memory-iterations-quick').value);

                // å‘é€åˆ°åç«¯
                const response = await fetch(`${API_BASE}/dynamic-config`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(currentConfig)
                });

                const data = await response.json();
                if (data.success) {
                    showToast('é…ç½®ä¿å­˜æˆåŠŸï¼', 'success');
                } else {
                    showToast('ä¿å­˜å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'), 'error');
                }
            } catch (error) {
                showToast('ä¿å­˜é…ç½®å¤±è´¥: ' + error.message, 'error');
            }
        }

        // å¯¼å‡ºé…ç½®
        function exportConfig() {
            if (!currentConfig) {
                showToast('è¯·å…ˆåŠ è½½é…ç½®', 'warning');
                return;
            }

            const blob = new Blob([JSON.stringify(currentConfig, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `benchmark-config-${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('é…ç½®å·²å¯¼å‡º', 'success');
        }

        // åº”ç”¨é…ç½®é¢„è®¾
        async function applyPreset(presetKey) {
            const preset = CONFIG_PRESETS[presetKey];
            if (!preset) {
                showToast('æœªæ‰¾åˆ°è¯¥é¢„è®¾', 'error');
                return;
            }

            try {
                // æ·±æ‹·è´é¢„è®¾é…ç½®
                currentConfig = JSON.parse(JSON.stringify(preset.config));

                // ä¿å­˜åˆ°æœåŠ¡å™¨
                const response = await fetch(`${API_BASE}/dynamic-config`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(currentConfig)
                });

                const data = await response.json();
                if (data.success) {
                    showToast(`å·²åº”ç”¨é¢„è®¾: ${preset.name}`, 'success');
                    // é‡æ–°åŠ è½½é…ç½®åˆ°UI
                    await loadQuickConfig();
                } else {
                    showToast('åº”ç”¨é¢„è®¾å¤±è´¥', 'error');
                }
            } catch (error) {
                showToast('åº”ç”¨é¢„è®¾å¤±è´¥: ' + error.message, 'error');
            }
        }

        // å¯¼å…¥é…ç½®
        function importConfig() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                try {
                    const text = await file.text();
                    currentConfig = JSON.parse(text);
                    await loadQuickConfig();
                    showToast('é…ç½®å·²å¯¼å…¥', 'success');
                } catch (error) {
                    showToast('å¯¼å…¥å¤±è´¥: ' + error.message, 'error');
                }
            };
            input.click();
        }

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + Enter: å¯åŠ¨æµ‹è¯•
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                const startBtn = document.getElementById('start-btn');
                if (!startBtn.disabled) {
                    startBenchmark();
                }
            }

            // Ctrl/Cmd + S: ä¿å­˜é…ç½®
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                saveQuickConfig();
            }
        });

        // é¡µé¢å…³é—­æ—¶æ¸…ç† WebSocket
        window.addEventListener('beforeunload', () => {
            if (ws) {
                ws.close();
            }
            if (reconnectInterval) {
                clearInterval(reconnectInterval);
            }
        });

        // é¡µé¢å¯è§æ€§å˜åŒ–æ—¶é‡è¿ WebSocket
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                // é¡µé¢æ¢å¤å¯è§æ—¶ï¼Œç¡®ä¿ WebSocket å·²è¿æ¥
                connectWebSocket();
            }
        });

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = async () => {
            // è¿æ¥ WebSocketï¼ˆä¼šè‡ªåŠ¨æ¥æ”¶çŠ¶æ€æ›´æ–°ï¼‰
            connectWebSocket();

            // åŠ è½½å…¶ä»–æ•°æ®
            await loadReports();
            await loadQuickConfig();
        };
    </script>
</body>
</html>
