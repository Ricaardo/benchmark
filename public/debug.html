<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIè°ƒè¯• - Benchmark Web Runner</title>

    <!-- ç»Ÿä¸€è®¾è®¡ç³»ç»Ÿ -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/navigation.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="stylesheet" href="/css/enhanced-ui.css">
    <link rel="stylesheet" href="/css/common-components.css">
    <link rel="stylesheet" href="/css/button-fixes.css">
</head>
<body>
    <div class="container">
        <!-- å…¨å±€å¯¼èˆªæ  -->
        <nav class="navbar animate-fade-in-down" id="main-navbar">
            <a href="/" class="navbar-brand">
                <span class="navbar-logo">ğŸš€</span>
                <div>
                    <h1 class="navbar-title">Benchmark Web Runner</h1>
                    <p class="navbar-subtitle">ç”¨ä¾‹é©±åŠ¨çš„æ€§èƒ½æµ‹è¯•å¹³å°</p>
                </div>
            </a>

            <button class="navbar-toggle" id="navbar-toggle" onclick="toggleMobileMenu()">
                <span class="navbar-toggle-bar"></span>
                <span class="navbar-toggle-bar"></span>
                <span class="navbar-toggle-bar"></span>
            </button>

            <div class="navbar-menu" id="navbar-menu">
                <a href="/" class="navbar-item">
                    <span>ğŸ“‹</span> ç”¨ä¾‹ç®¡ç†
                </a>
                <a href="/records.html" class="navbar-item">
                    <span>ğŸ“Š</span> æµ‹è¯•è®°å½•
                </a>
                <a href="/workers.html" class="navbar-item">
                    <span>ğŸ–¥ï¸</span> èŠ‚ç‚¹ç®¡ç†
                </a>
                <a href="/debug.html" class="navbar-item active">
                    <span>ğŸ”</span> APIè°ƒè¯•
                </a>
            </div>
        </nav>

        <!-- è°ƒè¯•é¡µé¢å†…å®¹ -->
        <div class="card animate-fade-in-up">
            <h2>ğŸ” æµ‹è¯•ç”¨ä¾‹ç®¡ç†è°ƒè¯•é¡µé¢</h2>

            <!-- APIè¿æ¥æµ‹è¯• -->
            <div class="card" style="margin-top: 20px;">
                <h3>1. æµ‹è¯•APIè¿æ¥</h3>
                <button class="btn btn-primary" onclick="testAPI()">ğŸ§ª æµ‹è¯•API</button>
                <div id="api-result" style="margin-top: 15px;"></div>
            </div>

            <!-- æŒ‰é’®æ¸²æŸ“æµ‹è¯• -->
            <div class="card" style="margin-top: 20px;">
                <h3>2. æµ‹è¯•æŒ‰é’®æ¸²æŸ“</h3>
                <div id="test-buttons"></div>
            </div>

            <!-- æ§åˆ¶å°æ—¥å¿— -->
            <div class="card" style="margin-top: 20px;">
                <h3>3. æ§åˆ¶å°æ—¥å¿—</h3>
                <div class="output-panel" id="console-log" style="min-height: 200px; max-height: 400px;"></div>
            </div>
        </div>
    </div>

    <script>
        const logDiv = document.getElementById('console-log');

        function log(msg) {
            const time = new Date().toLocaleTimeString();
            const logLine = document.createElement('div');
            logLine.textContent = `[${time}] ${msg}`;
            logDiv.appendChild(logLine);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(msg);
        }

        async function testAPI() {
            log('å¼€å§‹æµ‹è¯•API...');
            try {
                const response = await fetch('/api/testcases');
                const data = await response.json();
                log(`âœ“ APIå“åº”æˆåŠŸï¼Œè·å–åˆ° ${data.testCases.length} ä¸ªæµ‹è¯•ç”¨ä¾‹`);

                const resultDiv = document.getElementById('api-result');
                resultDiv.innerHTML = `
                    <div class="card" style="background: var(--color-gray-50); margin-top: 10px;">
                        <pre style="margin: 0; white-space: pre-wrap; word-wrap: break-word; font-family: 'Monaco', monospace; font-size: 0.9em;">${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;

                // æ¸²æŸ“æµ‹è¯•æŒ‰é’®
                renderTestButtons(data.testCases);
            } catch (error) {
                log(`âœ— APIè°ƒç”¨å¤±è´¥: ${error.message}`);
                const resultDiv = document.getElementById('api-result');
                resultDiv.innerHTML = `
                    <div class="alert alert-error" style="background: var(--color-danger-100); color: var(--color-danger-700); padding: 15px; border-radius: 8px; margin-top: 10px;">
                        <strong>é”™è¯¯:</strong> ${error.message}
                    </div>
                `;
            }
        }

        function renderTestButtons(testCases) {
            log('å¼€å§‹æ¸²æŸ“æŒ‰é’®...');
            const container = document.getElementById('test-buttons');

            if (testCases.length === 0) {
                container.innerHTML = '<p class="text-muted">æš‚æ— æµ‹è¯•ç”¨ä¾‹</p>';
                return;
            }

            const html = testCases.map(tc => {
                log(`æ¸²æŸ“æµ‹è¯•ç”¨ä¾‹: ${tc.name} (ID: ${tc.id})`);
                return `
                    <div class="card" style="margin: 10px 0; padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${tc.name}</strong>
                                <br>
                                <small class="text-muted">ID: ${tc.id}</small>
                            </div>
                            <button class="btn btn-success btn-sm" onclick="testClick('${tc.id}', '${tc.name}')">
                                âœ“ ç‚¹å‡»æµ‹è¯•
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
            log(`âœ“ å·²æ¸²æŸ“ ${testCases.length} ä¸ªæµ‹è¯•æŒ‰é’®`);
        }

        function testClick(id, name) {
            log(`âœ“ æŒ‰é’®ç‚¹å‡»æˆåŠŸ! ID: ${id}, åç§°: ${name}`);
            showToast(`ç‚¹å‡»æˆåŠŸ!\nID: ${id}\nåç§°: ${name}`, 'success');
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999; padding: 15px 20px; background: var(--color-success-500); color: white; border-radius: 8px; box-shadow: var(--shadow-lg); animation: slideIn 0.3s;';
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.3s';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // å¯¼èˆªæ äº¤äº’
        function toggleMobileMenu() {
            const toggle = document.getElementById('navbar-toggle');
            const menu = document.getElementById('navbar-menu');
            if (toggle && menu) {
                toggle.classList.toggle('active');
                menu.classList.toggle('show');
            }
        }

        window.addEventListener('scroll', function() {
            const navbar = document.getElementById('main-navbar');
            if (navbar) {
                if (window.scrollY > 20) {
                    navbar.classList.add('navbar-scrolled');
                } else {
                    navbar.classList.remove('navbar-scrolled');
                }
            }
        });

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = () => {
            log('ğŸ“ é¡µé¢åŠ è½½å®Œæˆï¼Œè‡ªåŠ¨æµ‹è¯•API...');
            testAPI();
        };
    </script>
    <!-- UIå·¥å…·åº“ -->
    <script src="/js/ui-utils.js"></script>
</body>
</html>
