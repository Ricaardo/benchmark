<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æ§åˆ¶å°è¯Šæ–­å·¥å…·</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
        .warning { color: #dcdcaa; }
        .info { color: #569cd6; }
        pre { background: #252526; padding: 10px; border-radius: 4px; overflow: auto; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        #output { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>ğŸ” JavaScript è¯Šæ–­å·¥å…·</h1>
    <button onclick="testFunctions()">æµ‹è¯•æ‰€æœ‰å‡½æ•°</button>
    <button onclick="testElements()">æµ‹è¯•DOMå…ƒç´ </button>
    <button onclick="testData()">æµ‹è¯•æ•°æ®åŠ è½½</button>
    <button onclick="clearOutput()">æ¸…ç©ºè¾“å‡º</button>
    
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        function log(msg, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `[${time}] ${msg}`;
            output.appendChild(div);
            console.log(msg);
        }
        
        function clearOutput() {
            output.innerHTML = '';
        }
        
        function testFunctions() {
            log('=== æµ‹è¯•å‡½æ•°å®šä¹‰ ===', 'info');
            
            const functions = [
                'showAddCaseModal',
                'runCase',
                'editCase',
                'deleteCase',
                'toggleCaseSelection',
                'renderCases',
                'loadTestCasesFromBackend'
            ];
            
            functions.forEach(name => {
                if (typeof window[name] === 'function') {
                    log(`âœ“ ${name} å·²å®šä¹‰`, 'success');
                } else {
                    log(`âœ— ${name} æœªå®šä¹‰`, 'error');
                }
            });
        }
        
        function testElements() {
            log('=== æµ‹è¯•DOMå…ƒç´  ===', 'info');
            
            const elements = [
                'cases-container',
                'case-modal',
                'runner-initialization',
                'runner-runtime',
                'runner-memoryleak',
                'testcase-device-type'
            ];
            
            elements.forEach(id => {
                const elem = document.getElementById(id);
                if (elem) {
                    log(`âœ“ ${id} å­˜åœ¨ (${elem.tagName})`, 'success');
                } else {
                    log(`âœ— ${id} ä¸å­˜åœ¨`, 'warning');
                }
            });
        }
        
        async function testData() {
            log('=== æµ‹è¯•æ•°æ®åŠ è½½ ===', 'info');
            
            try {
                const response = await fetch('/api/testcases');
                if (!response.ok) {
                    log(`âœ— APIå“åº”é”™è¯¯: ${response.status}`, 'error');
                    return;
                }
                
                const data = await response.json();
                log(`âœ“ APIå“åº”æˆåŠŸ`, 'success');
                log(`  æµ‹è¯•ç”¨ä¾‹æ•°é‡: ${data.testCases?.length || 0}`, 'info');
                
                if (data.testCases && data.testCases.length > 0) {
                    const first = data.testCases[0];
                    log(`  ç¬¬ä¸€ä¸ªç”¨ä¾‹ID: ${first.id}`, 'info');
                    log(`  ç¬¬ä¸€ä¸ªç”¨ä¾‹åç§°: ${first.name}`, 'info');
                    log(`  IDç±»å‹: ${typeof first.id}`, 'info');
                }
                
                log('å®Œæ•´æ•°æ®:', 'info');
                const pre = document.createElement('pre');
                pre.textContent = JSON.stringify(data, null, 2);
                output.appendChild(pre);
                
            } catch (error) {
                log(`âœ— æ•°æ®åŠ è½½å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½åè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = () => {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨æµ‹è¯•...', 'info');
            testFunctions();
            testElements();
            testData();
        };
    </script>
</body>
</html>
